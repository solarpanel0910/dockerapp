<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>æŠ•ç¥¨çµæœ</title>
    <!-- Chart.js ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        font-family: sans-serif;
        text-align: center;
        padding: 20px;
        background-color: #fff;
      }
      .chart-container {
        position: relative;
        height: 60vh;
        width: 90vw;
        margin: 0 auto;
      }
      .nav-link {
        margin-bottom: 20px;
        font-size: 1.2em;
        display: inline-block;
        text-decoration: none;
        color: #007bff;
        border: 1px solid #007bff;
        padding: 8px 16px;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <div style="text-align: left">
      <a href="/" class="nav-link">ğŸ‘ˆ æŠ•ç¥¨ç”»é¢ã«æˆ»ã‚‹</a>
    </div>

    <h1>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æŠ•ç¥¨çµæœ</h1>

    <div class="chart-container">
      <canvas id="voteChart"></canvas>
    </div>

    <script>
      let myChart = null;

      async function updateChart() {
        // ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        const response = await fetch("/api/votes");
        const data = await response.json();

        // ãƒ‡ãƒ¼ã‚¿ã‚’Chart.jsç”¨ã«åŠ å·¥
        const labels = data.map((item) => item.name);
        const counts = data.map((item) => item.count);

        const ctx = document.getElementById("voteChart").getContext("2d");

        // åˆå›æç”»
        if (myChart === null) {
          myChart = new Chart(ctx, {
            type: "bar", // ç¸¦æ£’ã‚°ãƒ©ãƒ•
            data: {
              labels: labels,
              datasets: [
                {
                  label: "å¾—ç¥¨æ•°",
                  data: counts,
                  backgroundColor: "rgba(54, 162, 235, 0.6)",
                  borderColor: "rgba(54, 162, 235, 1)",
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: { beginAtZero: true, ticks: { stepSize: 1 } },
              },
            },
          });
        } else {
          // 2å›ç›®ä»¥é™ã¯ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
          myChart.data.labels = labels;
          myChart.data.datasets[0].data = counts;
          myChart.update();
        }
      }

      // åˆå›å®Ÿè¡Œã¨è‡ªå‹•æ›´æ–°
      updateChart();
      setInterval(updateChart, 3000);
    </script>
  </body>
</html>
