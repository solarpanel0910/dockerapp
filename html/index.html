<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <title>メニュー投票</title>
  <style>
    /* 全体の見た目を整えます */
    body {
      font-family: sans-serif;
      text-align: center;
    }

    /* メニューを表示するカードの見た目です */
    .menu-card {
      border: 1px solid #ccc;
      margin: 10px;
      padding: 10px;
      display: inline-block;
      width: 200px;
    }

    /* ボタンにマウスを乗せた時に分かりやすくします */
    button {
      cursor: pointer;
    }
  </style>
</head>

<body>
  <!-- 結果画面へ行くためのリンクです -->
  <a href="/result.html">📊 投票結果を見る</a>
  <!-- タイトルです -->
  <h1>今日のランチ、何にする？</h1>

  <!-- ここにメニューが追加されます -->
  <div id="menu-container"></div>

  <script>
    // 画面にメニューを表示するための「関数（命令のセット）」です
    async function loadMenu() {
      // サーバーから「投票データ」を受け取ります
      const response = await fetch("/api/votes");
      // 受け取ったデータを、プログラムで使いやすい形（配列）にします
      const menu_data_list = await response.json();

      // メニューを表示する場所（container）を探します
      const container = document.getElementById("menu-container");

      // 最初は中身を空っぽにします
      container.innerHTML = "";

      // メニューの数だけ、1つずつ処理を繰り返します（標準的なforループ）
      for (let i = 0; i < menu_data_list.length; i = i + 1) {
        // 現在のメニューのデータを取り出します
        const item = menu_data_list[i];

        // 新しく「div」という箱（カード）を作ります
        const card = document.createElement("div");
        // 作った箱に「menu-card」という名前（クラス）を付けます
        card.className = "menu-card";

        // 箱の中身（メニュー名とボタン）を作ります
        // item.name がメニューの名前、item.id がメニューの番号です
        card.innerHTML = "<p>" + item.name + "</p>" +
          "<button onclick='vote(" + item.id + ")'>投票する</button>";

        // 最後に、メニューを表示する場所（container）にこの箱を追加します
        container.appendChild(card);
      }
    }

    // ボタンが押された時に「投票する」ための関数です
    async function vote(selected_menu_id) {
      // サーバーに「この番号のメニューに投票しました」と伝えます
      await fetch("/api/vote/" + selected_menu_id, { method: "POST" });

      // 投票完了のメッセージを画面に出します
      alert("投票しました！");
    }

    // ページを読み込んだ時に、まずメニューを表示する関数を実行します
    loadMenu();
  </script>
</body>

</html>